<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"docbookV4.5/docbookx.dtd" [
<!ENTITY % myents SYSTEM "scidb_ug.ent">
%myents;
]>
<section id="upgradingSciDB">
  <title>DO NOT EDIT Upgrading SciDB</title>

  <para>DO NOT EDIT THIS FILE.</para>

  <para>DO NOT EDIT THIS FILE.</para>

  <para>DO NOT EDIT THIS FILE.</para>

  <para>DO NOT EDIT THIS FILE.</para>

  <para>DO NOT EDIT THIS FILE.</para>

  <para>DO NOT EDIT THIS FILE.</para>

  <para>DO NOT EDIT THIS FILE.</para>

  <para>DO NOT EDIT THIS FILE.</para>

  <para>DO NOT EDIT THIS FILE.</para>

  <para>DO NOT EDIT THIS FILE.</para>

  <para>DO NOT EDIT THIS FILE.</para>

  <para>DO NOT EDIT THIS FILE.</para>

  <para>DO NOT EDIT THIS FILE.</para>

  <para>DO NOT EDIT THIS FILE.</para>

  <para>DO NOT EDIT THIS FILE.</para>

  <para>DO NOT EDIT THIS FILE.</para>

  <para>DO NOT EDIT THIS FILE.</para>

  <para>DO NOT EDIT THIS FILE.</para>

  <para>DO NOT EDIT THIS FILE.</para>

  <para>DO NOT EDIT THIS FILE.</para>

  <para><indexterm>
      <primary>SciDB</primary>

      <secondary>upgrading</secondary>
    </indexterm><indexterm>
      <primary>upgrade SciDB</primary>
    </indexterm><indexterm>
      <primary>versions</primary>

      <secondary>SciDB</secondary>
    </indexterm></para>

  <para>This section describes the process for installing SciDB 14.8 on a
  cluster on which a previous version of SciDB is already installed. This
  section uses the following conventions:<itemizedlist>
      <listitem>
        <para>To represent your current version: <emphasis
        role="bold">scidbOldVersion</emphasis>.</para>
      </listitem>

      <listitem>
        <para>To represent the new version that you are installing: <emphasis
        role="bold">scidbNewVersion</emphasis>.</para>
      </listitem>
    </itemizedlist></para>

  <para>For example, if you are upgrading from 14.3 to 14.8:<itemizedlist>
      <listitem>
        <para><emphasis role="bold">scidbOldVersion</emphasis> = 14.3</para>
      </listitem>

      <listitem>
        <para><emphasis role="bold">scidbNewVersion</emphasis> = 14.8</para>
      </listitem>
    </itemizedlist></para>

  <para>If you are installing SciDB 14.8 on a cluster with a previous version
  of SciDB, perform the following steps:</para>

  <procedure>
    <step>
      <para><emphasis role="bold">Backup.</emphasis> If your existing
      installation is 14.7, you can skip this step and proceed to step 2. If
      your existing installation is 14.3, you should back up your data using
      the script, <code>scidb_backup.py</code>. This file is in the
      /opt/scidb/14.8/bin folder. First, confirm that you have enough storage
      space, because the following command will backup all your SciDB arrays.
      From the <emphasis role="bold">scidb</emphasis> user account, run the
      backup script. As an example, the following command creates a folder,
      <emphasis role="bold">./mySavedArrays</emphasis>, and saves all of your
      arrays, using the OPAQUE format, into that folder:<programlisting>$ /opt/scidb/14.8/bin/scidb_backup.py -s opaque mySavedArrays</programlisting>For
      usage details of the backup script, see <xref
      linkend="upgradeBackup"/>.</para>
    </step>

    <step>
      <para>Stop SciDB.</para>
    </step>

    <step>
      <para>If you want to keep your current SciDB configuration file, make a
      backup copy of it somewhere. By default, the file is in the following
      location:<screen>opt/scidb/<emphasis role="bold">scidbOldVersion</emphasis>/etc/config.ini</screen></para>
    </step>

    <step>
      <para><emphasis role="bold">OPTIONAL.</emphasis> You can run multiple
      versions of SciDB: for details, see <xref linkend="multipleSciDBs"/>.
      However, if you need only the latest version of SciDB, you can remove
      the previous version. If you installed to the default location, run the
      following command to remove the old version:<programlisting>sudo rm -Rf /opt/scidb/<emphasis
            role="bold">scidbOldVersion</emphasis>/</programlisting></para>
    </step>

    <step>
      <para><emphasis role="bold">Upgrade. </emphasis>Perform the following
      steps to upgrade to version 14.8 of SciDB.<orderedlist
          numeration="loweralpha">
          <listitem>
            <para>Set up your configuration file. Be sure to change all
            occurrences of <emphasis role="bold">scidbOldVersion</emphasis> to
            <emphasis role="bold">scidbNewVersion</emphasis>. After you edit
            the file, copy it to the
            <literal>/opt/scidb/14.8</literal><literal>/etc/</literal>
            folder.</para>

            <para>Typically, the following settings are
            affected:<programlisting>install_root=/opt/scidb/14.3
pluginsdir=/opt/scidb/14.3/lib/scidb/plugins
logconf=/opt/scidb/14.3/share/scidb/log4cxx.properties</programlisting></para>

            <para>Also, be sure to add the following setting to the
            configuration file (if it does not already exist):<programlisting>enable-catalog-upgrade=true</programlisting>For
            more details about the configuration file, see <xref
            linkend="ConfiguringSciDB"/>.</para>
          </listitem>

          <listitem>
            <para>Run the cluster install procedure, available at <ulink
            url="https://github.com/Paradigm4/deployment">https://github.com/Paradigm4/deployment</ulink>.</para>
          </listitem>

          <listitem>
            <para>Restart SciDB. If your previous installation was 14.3, use
            the following command:</para>

            <programlisting>scidb.py initall <replaceable>scidb_cluster_name</replaceable></programlisting>

            <note>
              <para>If you get an error that says SciDB needs to upgrade the
              system catalog, and that the action failed, make sure to set the
              <code>enable-catalog-upgrade</code> parameter to <emphasis
              role="bold">true</emphasis>, as detailed in the previous step
              <emphasis role="bold">a</emphasis>.</para>
            </note>

            <para>If your previous installation was 14.7, use the following
            command:</para>

            <programlisting>scidb.py startall <replaceable>scidb_cluster_name</replaceable></programlisting>
          </listitem>
        </orderedlist></para>
    </step>

    <step>
      <para><emphasis role="bold">Restore. </emphasis>After you have the new
      version of SciDB running, restore any data that you backed up in step 1.
      For example, if you used the command in step 1 to backup your arrays,
      you would run the following command to restore them:<programlisting>$ /opt/scidb/14.7/bin/scidb_backup.py -r opaque mySavedArrays</programlisting></para>
    </step>
  </procedure>
</section>
